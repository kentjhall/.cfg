alias vmrun="/Applications/VMWare\ Fusion.app/Contents/Library/vmrun"

vmw() {
	# parse args
	VM_NAME=
	case "$1" in
		OS)
			VM_NAME="Debian (OS 4118)"
			;;
		deb)
			VM_NAME="Debian"
			;;
		*)
			echo "Unrecognized VM identifier" >&2
			return 1
			;;
	esac
	ACTION="$2"
	shift

	VM_PATH="$HOME/Virtual Machines.localized/$VM_NAME.vmwarevm/$VM_NAME.vmx"

	# stopping the VM
	if [ "$ACTION" == "stop" ]; then
		vmrun stop "$VM_PATH"
		return
	fi

	# restarting the VM
	if [ "$ACTION" == "restart" ]; then
		vmrun stop "$VM_PATH" || return
		shift
	fi

	# start the VM (if not already running)	
	if ! vmrun list | tail -n +2 | grep "$VM_PATH" > /dev/null; then
		vmrun start "$VM_PATH" nogui || return
	fi

	# get guest IP address (loop in case booting up)
	VM_IP="$(vmrun getGuestIpAddress "$VM_PATH" -wait)" || return

	# ssh in
	ssh "kent@$VM_IP" "$@"
}

export WASMTIME_HOME="$HOME/.wasmtime"
export PATH="$PATH:$WASMTIME_HOME/bin"
